<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facial Muscles and Muscles of Mastication (MCQs) Quiz</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --primary-color: #3498db;
            --header-color: #2c3e50;
            --secondary-text: #7f8c8d;
            --progress-bg: #ecf0f1;
            --question-bg: #f8f9fa;
            --option-bg: #fff;
            --option-hover: #f1f8ff;
            --option-selected: #d1ecf1;
            --correct-bg: #d4edda;
            --correct-border: #28a745;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #dc3545;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --button-disabled: #bdc3c7;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #ecf0f1;
            --toggle-slider: white;
            --toggle-text: #7f8c8d;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --text-color: #e6e6e6;
            --border-color: #394867;
            --primary-color: #4cc9f0;
            --header-color: #e6e6e6;
            --secondary-text: #a9a9a9;
            --progress-bg: #394867;
            --question-bg: #1f4068;
            --option-bg: #16213e;
            --option-hover: #1f4068;
            --option-selected: #1f4068;
            --correct-bg: #2d5a2d;
            --correct-border: #4caf50;
            --incorrect-bg: #5a2d2d;
            --incorrect-border: #f44336;
            --button-bg: #4cc9f0;
            --button-hover: #3aa8d0;
            --button-disabled: #5d6d7e;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #394867;
            --toggle-slider: #4cc9f0;
            --toggle-text: #e6e6e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        h1 {
            color: var(--header-color);
            margin-bottom: 5px;
            font-size: 24px;
            transition: color 0.3s;
        }
        .author {
            color: var(--secondary-text);
            font-style: italic;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .description {
            color: var(--secondary-text);
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        .theme-toggle {
            position: absolute;
            top: 35px;
            right: 0;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--toggle-text);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 60px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-slider);
            transition: .4s;
            border-radius: 34px;
            z-index: 1;
        }
        .slider-text {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .light-text, .dark-text {
            transition: opacity 0.3s;
        }
        .dark-mode .light-text {
            opacity: 0.5;
        }
        .light-text {
            opacity: 0.5;
        }
        .dark-mode .dark-text {
            opacity: 1;
        }
        .dark-text {
            opacity: 0.5;
        }
        input:checked + .slider:before {
            transform: translateX(52px);
        }
        .progress-container {
            background: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            height: 10px;
            transition: background-color 0.3s;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .question {
            background: var(--question-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .options {
            display: grid;
            grid-gap: 10px;
        }
        .option {
            padding: 12px 15px;
            background: var(--option-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: var(--option-hover);
            border-color: var(--primary-color);
        }
        .option.selected {
            background: var(--option-selected);
            border-color: var(--primary-color);
        }
        .option.correct {
            background: var(--correct-bg);
            border-color: var(--correct-border);
        }
        .option.incorrect {
            background: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .feedback {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .feedback.correct {
            background: var(--correct-bg);
            color: var(--text-color);
            border: 1px solid var(--correct-border);
            display: block;
        }
        .feedback.incorrect {
            background: var(--incorrect-bg);
            color: var(--text-color);
            border: 1px solid var(--incorrect-border);
            display: block;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--button-hover);
        }
        button:disabled {
            background: var(--button-disabled);
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .score {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--header-color);
        }
        .score-value {
            font-size: 48px;
            color: var(--primary-color);
            font-weight: bold;
        }
        .restart-btn {
            margin-top: 20px;
            background: var(--restart-bg);
        }
        .restart-btn:hover {
            background: var(--restart-hover);
        }
        .review-btn {
            margin-top: 20px;
            background: var(--review-bg);
        }
        .review-btn:hover {
            background: var(--review-hover);
        }
        .review-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--question-bg);
            border-radius: 8px;
            display: none;
        }
        .review-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--header-color);
            text-align: center;
        }
        .review-question {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--incorrect-border);
            background: var(--container-bg);
            border-radius: 4px;
        }
        .review-question-number {
            font-weight: bold;
            color: var(--incorrect-border);
            margin-bottom: 8px;
        }
        .review-question-text {
            margin-bottom: 10px;
        }
        .review-answer {
            margin-top: 8px;
            font-weight: bold;
        }
        .review-correct {
            color: var(--correct-border);
        }
        .review-explanation {
            margin-top: 5px;
            font-style: italic;
            color: var(--secondary-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Facial Muscles and Muscles of Mastication (MCQs) Quiz</h1>
            <p class="author">Dr. Samy Salem</p>
            <p class="description">Test your knowledge of Facial Muscles, Muscles of Mastication, and Related Anatomy</p>
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider">
                        <div class="slider-text">
                            <span class="light-text">Light</span>
                            <span class="dark-text">Dark</span>
                        </div>
                    </span>
                </label>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats">
            <div>Question: <span id="current-question">1</span>/<span id="total-questions">35</span></div>
            <div>Score: <span id="score">0</span>/<span id="total-score">35</span></div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <div class="navigation">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>

        <div id="results" class="results">
            <div class="score">Your Score: <span class="score-value" id="final-score">0</span>/35</div>
            <p id="performance-message"></p>
            <button class="restart-btn" id="restart-btn">Restart Quiz</button>
            <button class="review-btn" id="review-btn">Review Incorrect Answers</button>
        </div>

        <div id="review-section" class="review-section">
            <h2 class="review-title">Questions Answered Incorrectly</h2>
            <div id="incorrect-questions-list"></div>
        </div>
    </div>

    <script>
        // Quiz data from Facial Muscles and Muscles of Mastication
        const originalQuizData = [
            {
                question: "What is the common origin for the facial muscles?",
                options: [
                    "Mandible",
                    "Skin",
                    "Skull",
                    "Fascia"
                ],
                answer: 2,
                explanation: "Skull (Page 3)"
            },
            {
                question: "All of the following are true about the facial muscles EXCEPT:",
                options: [
                    "They insert into skin.",
                    "They are responsible for facial expression.",
                    "They are mostly supplied by the trigeminal nerve.",
                    "The orbicularis oculi is one of them."
                ],
                answer: 2,
                explanation: "They are mostly supplied by the trigeminal nerve. (Page 3)"
            },
            {
                question: "Which nerve supplies all the muscles of facial expression?",
                options: [
                    "Mandibular nerve",
                    "Facial nerve",
                    "Trigeminal nerve",
                    "Spinal accessory nerve"
                ],
                answer: 1,
                explanation: "Facial nerve (Page 3)"
            },
            {
                question: "The orbicularis oculi muscle is primarily responsible for which action?",
                options: [
                    "Moving the lips",
                    "Closing the eye",
                    "Compressing the cheek",
                    "Elevating the mandible"
                ],
                answer: 1,
                explanation: "Closing the eye (Page 4)"
            },
            {
                question: "Which part of the orbicularis oculi is responsible for closing the eye forcibly?",
                options: [
                    "Palpebral part",
                    "Lacrimal part",
                    "Orbital part",
                    "Temporal part"
                ],
                answer: 2,
                explanation: "Orbital part (Page 4)"
            },
            {
                question: "A patient presents with an inability to close their eye lightly (e.g., during blinking). Which part of the orbicularis oculi is most likely affected?",
                options: [
                    "The palpebral part",
                    "The orbital part",
                    "The lacrimal part",
                    "The buccal part"
                ],
                answer: 0,
                explanation: "The palpebral part (Page 4)"
            },
            {
                question: "The lacrimal part of the orbicularis oculi is named so because its fibers wind around which structure?",
                options: [
                    "The lacrimal gland",
                    "The lacrimal sac",
                    "The nasolacrimal duct",
                    "The orbital margin"
                ],
                answer: 1,
                explanation: "The lacrimal sac (Page 4)"
            },
            {
                question: "What is the primary action of the lacrimal part of the orbicularis oculi?",
                options: [
                    "Closing the eye forcibly",
                    "Closing the eye lightly",
                    "Dilating the lacrimal sac",
                    "Compressing the lacrimal gland"
                ],
                answer: 2,
                explanation: "Dilating the lacrimal sac (Page 4)"
            },
            {
                question: "The orbicularis oris is the muscle of which structure?",
                options: [
                    "The cheek",
                    "The lip",
                    "The eyelid",
                    "The neck"
                ],
                answer: 1,
                explanation: "The lip (Page 6)"
            },
            {
                question: "Which muscle acts as a sphincter to close the mouth?",
                options: [
                    "Buccinator",
                    "Orbicularis oculi",
                    "Masseter",
                    "Orbicularis oris"
                ],
                answer: 3,
                explanation: "Orbicularis oris (Page 6)"
            },
            {
                question: "The buccinator muscle is located in which part of the body?",
                options: [
                    "The lip",
                    "The eyelid",
                    "The cheek",
                    "The neck"
                ],
                answer: 2,
                explanation: "The cheek (Page 8)"
            },
            {
                question: "Which muscle prevents the accumulation of food in the vestibule of the oral cavity?",
                options: [
                    "Orbicularis oris",
                    "Buccinator",
                    "Masseter",
                    "Medial pterygoid"
                ],
                answer: 1,
                explanation: "Buccinator (Page 8)"
            },
            {
                question: "The muscles of mastication share all of the following characteristics EXCEPT:",
                options: [
                    "Origin from the skull.",
                    "Insertion into the mandible.",
                    "Nerve supply from the facial nerve.",
                    "Action in mastication."
                ],
                answer: 2,
                explanation: "Nerve supply from the facial nerve. (Page 3, 12)"
            },
            {
                question: "All of the following muscles are primarily involved in mastication EXCEPT:",
                options: [
                    "Temporalis",
                    "Buccinator",
                    "Masseter",
                    "Medial pterygoid"
                ],
                answer: 1,
                explanation: "Buccinator (Page 8, 14, 16, 19)"
            },
            {
                question: "The temporalis muscle inserts onto which process of the mandible?",
                options: [
                    "Condylar process",
                    "Coronoid process",
                    "Alveolar process",
                    "Mental process"
                ],
                answer: 1,
                explanation: "Coronoid process (Page 14)"
            },
            {
                question: "Which part of the temporalis muscle is responsible for retracting the mandible?",
                options: [
                    "Its posterior fibres",
                    "Its anterior fibres",
                    "Its superior fibres",
                    "Its inferior fibres"
                ],
                answer: 0,
                explanation: "Its posterior fibres (Page 14)"
            },
            {
                question: "What is the primary action of the masseter muscle?",
                options: [
                    "Depression of mandible",
                    "Retraction of mandible",
                    "Protrusion of mandible",
                    "Elevation of mandible"
                ],
                answer: 3,
                explanation: "Elevation of mandible (Page 16)"
            },
            {
                question: "From which bony structure does the masseter muscle originate?",
                options: [
                    "Temporal fossa",
                    "Lateral pterygoid plate",
                    "Zygomatic arch",
                    "Mastoid process"
                ],
                answer: 2,
                explanation: "Zygomatic arch (Page 16)"
            },
            {
                question: "Which muscle has two heads of origin from the sphenoid bone?",
                options: [
                    "Temporalis",
                    "Masseter",
                    "Medial pterygoid",
                    "Lateral pterygoid"
                ],
                answer: 3,
                explanation: "Lateral pterygoid (Page 17)"
            },
            {
                question: "The lower head of the lateral pterygoid muscle inserts onto which structure?",
                options: [
                    "The coronoid process of the mandible",
                    "The pterygoid fossa on the condyloid process of the mandible",
                    "The joint capsule of the TMJ",
                    "The angle of the mandible"
                ],
                answer: 1,
                explanation: "The pterygoid fossa on the condyloid process of the mandible (Page 17)"
            },
            {
                question: "The primary action of the lateral pterygoid muscle is:",
                options: [
                    "Elevation of the mandible.",
                    "Retraction of the mandible.",
                    "Depression of the mandible.",
                    "Lateral flexion of the neck."
                ],
                answer: 2,
                explanation: "Depression of mandible. (Page 17)"
            },
            {
                question: "Which muscle originates from the tuberosity of the maxilla and the medial surface of the lateral pterygoid plate?",
                options: [
                    "Lateral pterygoid",
                    "Temporalis",
                    "Medial pterygoid",
                    "Masseter"
                ],
                answer: 2,
                explanation: "Medial pterygoid (Page 19)"
            },
            {
                question: "The medial pterygoid muscle inserts onto which part of the mandible?",
                options: [
                    "The coronoid process",
                    "The medial surface of the ramus and angle",
                    "The lateral surface of the ramus",
                    "The condylar process"
                ],
                answer: 1,
                explanation: "The medial surface of the ramus and angle (Page 19)"
            },
            {
                question: "Which of the following muscles is NOT an elevator of the mandible?",
                options: [
                    "Temporalis",
                    "Masseter",
                    "Lateral pterygoid",
                    "Medial pterygoid"
                ],
                answer: 2,
                explanation: "Lateral pterygoid (Page 14, 16, 17, 19)"
            },
            {
                question: "Both the medial and lateral pterygoid muscles acting together on both sides are responsible for which movement of the mandible?",
                options: [
                    "Retraction",
                    "Elevation",
                    "Protrusion",
                    "Depression"
                ],
                answer: 2,
                explanation: "Protrusion (Page 26)"
            },
            {
                question: "The Temporomandibular Joint (TMJ) is described as which type and variety of joint?",
                options: [
                    "Fibrous, suture variety",
                    "Cartilaginous, symphysis variety",
                    "Synovial, hinge variety",
                    "Synovial, condylar variety"
                ],
                answer: 3,
                explanation: "Synovial, condylar variety (Page 23)"
            },
            {
                question: "Which structure divides the cavity of the TMJ into upper and lower compartments?",
                options: [
                    "The articular capsule",
                    "The lateral ligament",
                    "The intra-articular disc",
                    "The synovial membrane"
                ],
                answer: 2,
                explanation: "The intra-articular disc (Page 23)"
            },
            {
                question: "Which muscles are responsible for elevating the mandible?",
                options: [
                    "Temporalis, masseter, and medial pterygoid",
                    "Lateral and medial pterygoid",
                    "Digastric and mylohyoid",
                    "Platysma and geniohyoid"
                ],
                answer: 0,
                explanation: "Temporalis, masseter, and medial pterygoid (Page 26)"
            },
            {
                question: "The sternocleidomastoid muscle inserts into which structure?",
                options: [
                    "Pharyngeal tubercle",
                    "Lateral pterygoid plate",
                    "Temporal fossa",
                    "Lateral surface of mastoid process and lateral 1/3 of superior nuchal line"
                ],
                answer: 3,
                explanation: "Lateral surface of mastoid process and lateral 1/3 of superior nuchal line (Page 26)"
            },
            {
                question: "Which nerve supplies the sternomastoid muscle?",
                options: [
                    "Facial nerve",
                    "Mandibular nerve",
                    "Spinal accessory nerve and C2, 3",
                    "Anterior rami of cervical nerves"
                ],
                answer: 2,
                explanation: "Spinal accessory nerve and C2, 3 (Page 29)"
            },
            {
                question: "If the right sternomastoid muscle acts alone, what movement occurs?",
                options: [
                    "The neck flexes forward.",
                    "The neck flexes towards the left side and the face rotates to the right.",
                    "The neck flexes towards the right side and the face rotates to the left.",
                    "The neck extends and the face rotates to the same side."
                ],
                answer: 2,
                explanation: "The neck flexes towards the right side and the face rotates to the left. (Page 32)"
            },
            {
                question: "When both sternomastoid muscles act together with the head fixed, they help to:",
                options: [
                    "Laterally flex the neck.",
                    "Depress the mandible.",
                    "Elevate the thorax in forced inspiration.",
                    "Rotate the head."
                ],
                answer: 2,
                explanation: "Elevate the thorax in forced inspiration. (Page 32)"
            },
            {
                question: "The scalene muscles are primarily responsible for all of the following actions EXCEPT:",
                options: [
                    "Lateral flexion of the neck.",
                    "Rotation of the head to the opposite side.",
                    "Elevation of the 1st and 2nd ribs.",
                    "Elevation of the 1st rib."
                ],
                answer: 1,
                explanation: "Rotation of the head to the opposite side. (Page 33, 35)"
            },
            {
                question: "The scalenus anterior muscle inserts onto which specific structure?",
                options: [
                    "The transverse processes of C3-6",
                    "The lateral surface of the 1st rib",
                    "The scalene tubercle on the inner border of the 1st rib",
                    "The 2nd rib"
                ],
                answer: 2,
                explanation: "The scalene tubercle on the inner border of the 1st rib (Page 35)"
            },
            {
                question: "The scalenus anterior muscle is innervated by which nerve/s?",
                options: [
                    "C4, C5, C6",
                    "C3, C4",
                    "CN XI",
                    "Axillary nerve"
                ],
                answer: 0,
                explanation: "C4, C5, C6 (Page 35)"
            }
        ];

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to create a randomized version of the quiz data
        function createRandomizedQuizData() {
            const randomizedData = [];
            
            originalQuizData.forEach(question => {
                // Create a copy of the original question
                const randomizedQuestion = {
                    question: question.question,
                    options: [...question.options], // Copy options array
                    originalAnswer: question.answer, // Store original answer index
                    explanation: question.explanation
                };
                
                // Create an array of indices [0, 1, 2, 3]
                const indices = [0, 1, 2, 3];
                
                // Shuffle the indices
                shuffleArray(indices);
                
                // Create a new options array with shuffled order
                const shuffledOptions = indices.map(index => question.options[index]);
                
                // Find the new position of the correct answer
                const newAnswerIndex = indices.indexOf(question.answer);
                
                // Update the question with shuffled options and new answer
                randomizedQuestion.options = shuffledOptions;
                randomizedQuestion.answer = newAnswerIndex;
                
                randomizedData.push(randomizedQuestion);
            });
            
            return randomizedData;
        }

        // Create randomized quiz data
        let quizData = createRandomizedQuizData();

        // Quiz state variables
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let incorrectQuestions = [];

        // DOM elements
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const resultsContainer = document.getElementById('results');
        const finalScoreEl = document.getElementById('final-score');
        const performanceMessageEl = document.getElementById('performance-message');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const reviewSection = document.getElementById('review-section');
        const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const lightText = document.querySelector('.light-text');
        const darkText = document.querySelector('.dark-text');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            showQuestion();
            updateProgressBar();
            
            // Initialize dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
                updateToggleText(true);
            } else {
                updateToggleText(false);
            }
            
            // Event listeners
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            reviewBtn.addEventListener('click', showIncorrectQuestions);
            darkModeToggle.addEventListener('change', toggleDarkMode);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateToggleText(isDarkMode);
        }

        // Update toggle text opacity
        function updateToggleText(isDarkMode) {
            if (isDarkMode) {
                lightText.style.opacity = '0.5';
                darkText.style.opacity = '1';
            } else {
                lightText.style.opacity = '1';
                darkText.style.opacity = '0.5';
            }
        }

        // Show current question
        function showQuestion() {
            currentQuestionEl.textContent = currentQuestion + 1;
            scoreEl.textContent = score;
            
            const question = quizData[currentQuestion];
            let optionsHTML = '';
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[currentQuestion] === index) {
                    optionClass += ' selected';
                    if (index === question.answer) {
                        optionClass += ' correct';
                    } else {
                        optionClass += ' incorrect';
                    }
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `;
            });
            
            let feedbackHTML = '';
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === question.answer;
                const correctLetter = String.fromCharCode(65 + question.answer);
                const correctAnswerText = question.options[question.answer];
                
                feedbackHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '✓ Correct!' : '✗ Incorrect!'} 
                        ${!isCorrect ? `Correct answer: ${correctLetter}) ${correctAnswerText}` : ''}
                        <br><br>Explanation: ${question.explanation}
                    </div>
                `;
            }
            
            quizContainer.innerHTML = `
                <div class="question">
                    <div class="question-number">Question ${currentQuestion + 1}/${quizData.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">${optionsHTML}</div>
                    ${feedbackHTML}
                </div>
            `;
            
            // Add event listeners to options
            const optionElements = quizContainer.querySelectorAll('.option');
            optionElements.forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Update navigation buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finish Quiz' : 'Next';
        }

        // Select an option
        function selectOption(e) {
            if (userAnswers[currentQuestion] !== null) return; // Already answered
            
            const selectedOption = e.currentTarget;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            userAnswers[currentQuestion] = selectedIndex;
            
            // Check if answer is correct
            if (selectedIndex === quizData[currentQuestion].answer) {
                score++;
                scoreEl.textContent = score;
            } else {
                // Add to incorrect questions list
                incorrectQuestions.push({
                    question: quizData[currentQuestion].question,
                    userAnswer: selectedIndex,
                    correctAnswer: quizData[currentQuestion].answer,
                    options: quizData[currentQuestion].options,
                    explanation: quizData[currentQuestion].explanation,
                    questionNumber: currentQuestion + 1
                });
            }
            
            showQuestion();
            updateProgressBar();
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show results
        function showResults() {
            quizContainer.style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            finalScoreEl.textContent = score;
            
            // Performance message
            const percentage = (score / quizData.length) * 100;
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Facial Muscles and Muscles of Mastication.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid grasp of the material.';
            } else if (percentage >= 40) {
                message = 'Not bad! Review the material and try again.';
            } else {
                message = 'Keep studying! Review the lectures and try again.';
            }
            
            performanceMessageEl.textContent = message;
            resultsContainer.style.display = 'block';
            
            // Show review button only if there are incorrect answers
            if (incorrectQuestions.length > 0) {
                reviewBtn.style.display = 'inline-block';
            } else {
                reviewBtn.style.display = 'none';
            }
        }

        // Show incorrect questions
        function showIncorrectQuestions() {
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'block';
            
            let incorrectHTML = '';
            incorrectQuestions.forEach((item, index) => {
                const correctLetter = String.fromCharCode(65 + item.correctAnswer);
                const userLetter = String.fromCharCode(65 + item.userAnswer);
                
                incorrectHTML += `
                    <div class="review-question">
                        <div class="review-question-number">Question ${item.questionNumber}</div>
                        <div class="review-question-text">${item.question}</div>
                        <div>Your answer: ${userLetter}) ${item.options[item.userAnswer]}</div>
                        <div class="review-answer review-correct">Correct answer: ${correctLetter}) ${item.options[item.correctAnswer]}</div>
                        <div class="review-explanation">${item.explanation}</div>
                    </div>
                `;
            });
            
            incorrectQuestionsList.innerHTML = incorrectHTML;
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            incorrectQuestions = [];
            
            // Re-randomize the quiz data when restarting
            quizData = createRandomizedQuizData();
            
            quizContainer.style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.progress-container').style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'none';
            
            showQuestion();
            updateProgressBar();
        }

        // Initialize the quiz when the page loads
        window.onload = initQuiz;
    </script>
</body>
</html>