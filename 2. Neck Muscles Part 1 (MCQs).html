<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCQs on Neck Muscles Part 1 Quiz</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --primary-color: #3498db;
            --header-color: #2c3e50;
            --secondary-text: #7f8c8d;
            --progress-bg: #ecf0f1;
            --question-bg: #f8f9fa;
            --option-bg: #fff;
            --option-hover: #f1f8ff;
            --option-selected: #d1ecf1;
            --correct-bg: #d4edda;
            --correct-border: #28a745;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #dc3545;
            --button-bg: #3498db;
            --button-hover: #2980b9;
            --button-disabled: #bdc3c7;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #ecf0f1;
            --toggle-slider: white;
            --toggle-text: #7f8c8d;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --container-bg: #16213e;
            --text-color: #e6e6e6;
            --border-color: #394867;
            --primary-color: #4cc9f0;
            --header-color: #e6e6e6;
            --secondary-text: #a9a9a9;
            --progress-bg: #394867;
            --question-bg: #1f4068;
            --option-bg: #16213e;
            --option-hover: #1f4068;
            --option-selected: #1f4068;
            --correct-bg: #2d5a2d;
            --correct-border: #4caf50;
            --incorrect-bg: #5a2d2d;
            --incorrect-border: #f44336;
            --button-bg: #4cc9f0;
            --button-hover: #3aa8d0;
            --button-disabled: #5d6d7e;
            --restart-bg: #2ecc71;
            --restart-hover: #27ae60;
            --review-bg: #f39c12;
            --review-hover: #e67e22;
            --toggle-bg: #394867;
            --toggle-slider: #4cc9f0;
            --toggle-text: #e6e6e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            position: relative;
        }
        h1 {
            color: var(--header-color);
            margin-bottom: 5px;
            font-size: 24px;
            transition: color 0.3s;
        }
        .author {
            color: var(--secondary-text);
            font-style: italic;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .description {
            color: var(--secondary-text);
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        .theme-toggle {
            position: absolute;
            top: 35px;
            right: 0;
            display: flex;
            align-items: center;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 120px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--toggle-bg);
            transition: .4s;
            border-radius: 34px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 12px;
            font-weight: bold;
            color: var(--toggle-text);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 60px;
            left: 4px;
            bottom: 4px;
            background-color: var(--toggle-slider);
            transition: .4s;
            border-radius: 34px;
            z-index: 1;
        }
        .slider-text {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .light-text, .dark-text {
            transition: opacity 0.3s;
        }
        .dark-mode .light-text {
            opacity: 0.5;
        }
        .light-text {
            opacity: 0.5;
        }
        .dark-mode .dark-text {
            opacity: 1;
        }
        .dark-text {
            opacity: 0.5;
        }
        input:checked + .slider:before {
            transform: translateX(52px);
        }
        .progress-container {
            background: var(--progress-bg);
            border-radius: 5px;
            margin-bottom: 20px;
            position: relative;
            height: 10px;
            transition: background-color 0.3s;
        }
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--header-color);
            transition: color 0.3s;
        }
        .question {
            background: var(--question-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        .question-text {
            font-size: 18px;
            margin-bottom: 15px;
        }
        .options {
            display: grid;
            grid-gap: 10px;
        }
        .option {
            padding: 12px 15px;
            background: var(--option-bg);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .option:hover {
            background: var(--option-hover);
            border-color: var(--primary-color);
        }
        .option.selected {
            background: var(--option-selected);
            border-color: var(--primary-color);
        }
        .option.correct {
            background: var(--correct-bg);
            border-color: var(--correct-border);
        }
        .option.incorrect {
            background: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .feedback {
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }
        .feedback.correct {
            background: var(--correct-bg);
            color: var(--text-color);
            border: 1px solid var(--correct-border);
            display: block;
        }
        .feedback.incorrect {
            background: var(--incorrect-bg);
            color: var(--text-color);
            border: 1px solid var(--incorrect-border);
            display: block;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        button {
            padding: 10px 20px;
            background: var(--button-bg);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        button:hover {
            background: var(--button-hover);
        }
        button:disabled {
            background: var(--button-disabled);
            cursor: not-allowed;
        }
        .results {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .score {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--header-color);
        }
        .score-value {
            font-size: 48px;
            color: var(--primary-color);
            font-weight: bold;
        }
        .restart-btn {
            margin-top: 20px;
            background: var(--restart-bg);
        }
        .restart-btn:hover {
            background: var(--restart-hover);
        }
        .review-btn {
            margin-top: 20px;
            background: var(--review-bg);
        }
        .review-btn:hover {
            background: var(--review-hover);
        }
        .review-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--question-bg);
            border-radius: 8px;
            display: none;
        }
        .review-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--header-color);
            text-align: center;
        }
        .review-question {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--incorrect-border);
            background: var(--container-bg);
            border-radius: 4px;
        }
        .review-question-number {
            font-weight: bold;
            color: var(--incorrect-border);
            margin-bottom: 8px;
        }
        .review-question-text {
            margin-bottom: 10px;
        }
        .review-answer {
            margin-top: 8px;
            font-weight: bold;
        }
        .review-correct {
            color: var(--correct-border);
        }
        .review-explanation {
            margin-top: 5px;
            font-style: italic;
            color: var(--secondary-text);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>MCQs on Neck Muscles Part 1 Quiz</h1>
            <p class="author">Dr. Samy Salem</p>
            <p class="description">Test your knowledge of Neck Muscles: triangles, muscles, nerves, and blood supply</p>
            <div class="theme-toggle">
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider">
                        <div class="slider-text">
                            <span class="light-text">Light</span>
                            <span class="dark-text">Dark</span>
                        </div>
                    </span>
                </label>
            </div>
        </header>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="stats">
            <div>Question: <span id="current-question">1</span>/<span id="total-questions">40</span></div>
            <div>Score: <span id="score">0</span>/<span id="total-score">40</span></div>
        </div>

        <div id="quiz-container">
            <!-- Questions will be inserted here by JavaScript -->
        </div>

        <div class="navigation">
            <button id="prev-btn" disabled>Previous</button>
            <button id="next-btn">Next</button>
        </div>

        <div id="results" class="results">
            <div class="score">Your Score: <span class="score-value" id="final-score">0</span>/40</div>
            <p id="performance-message"></p>
            <button class="restart-btn" id="restart-btn">Restart Quiz</button>
            <button class="review-btn" id="review-btn">Review Incorrect Answers</button>
        </div>

        <div id="review-section" class="review-section">
            <h2 class="review-title">Questions Answered Incorrectly</h2>
            <div id="incorrect-questions-list"></div>
        </div>
    </div>

    <script>
        // Quiz data from Neck Muscles Part 1 PDF (extracted from 2. Neck Muscles Part 1 (MCQs).pdf)
        const originalQuizData = [
            {
                question: "The anterior triangle of the neck is subdivided by which two muscles?",
                options: [
                    "Sternohyoid and Sternothyroid",
                    "Digastric and the superior belly of Omohyoid",
                    "Stylohyoid and Mylohyoid",
                    "Thyrohyoid and Sternocleidomastoid"
                ],
                answer: 1,
                explanation: "Page 13"
            },
            {
                question: "The four sub-triangles of the anterior triangle are:",
                options: [
                    "Submental, Submandibular, Muscular, and Carotid",
                    "Submental, Digestric, Thyroid, and Carotid",
                    "Submandibular, Hyoid, Muscular, and Vertebral",
                    "Digestric, Sublingual, Muscular, and Carotid"
                ],
                answer: 0,
                explanation: "Page 13, 15"
            },
            {
                question: "The digastric muscle has two bellies. What are their origins?",
                options: [
                    "Anterior belly from hyoid bone; Posterior belly from mandible",
                    "Anterior belly from digestive fossa of mandible; Posterior belly from mastoid notch of temporal bone",
                    "Anterior belly from styloid process; Posterior belly from hyoid bone",
                    "Anterior belly from mastoid process; Posterior belly from mandible"
                ],
                answer: 1,
                explanation: "Page 7"
            },
            {
                question: "The intermediate tendon of the digastric muscle inserts onto which structure?",
                options: [
                    "The angle of the mandible",
                    "The mastoid process",
                    "The body of the hyoid bone",
                    "The thyroid cartilage"
                ],
                answer: 2,
                explanation: "Page 7"
            },
            {
                question: "The nerve supply to the anterior belly of the digastric muscle is:",
                options: [
                    "Facial nerve",
                    "Hypoglossal nerve",
                    "Ansa cervicalis",
                    "Nerve to mylohyoid (from mandibular nerve)"
                ],
                answer: 3,
                explanation: "Page 7"
            },
            {
                question: "The posterior belly of the digastric muscle is supplied by which nerve?",
                options: [
                    "Mandibular nerve",
                    "Hypoglossal nerve",
                    "Facial nerve",
                    "Glossopharyngeal nerve"
                ],
                answer: 2,
                explanation: "Page 7"
            },
            {
                question: "Which of the following is an action of the digastric muscle?",
                options: [
                    "Elevation of the larynx",
                    "Depression of the mandible",
                    "Elevation of the thyroid cartilage",
                    "Rotation of the head"
                ],
                answer: 1,
                explanation: "Page 8"
            },
            {
                question: "The stylohyoid muscle originates from which structure?",
                options: [
                    "Mastoid process",
                    "Hyoid bone",
                    "Styloid process",
                    "Mandible"
                ],
                answer: 2,
                explanation: "Page 9"
            },
            {
                question: "The stylohyoid muscle inserts onto the:",
                options: [
                    "Body of the hyoid bone",
                    "Angle of the mandible",
                    "Thyroid cartilage",
                    "Mastoid notch"
                ],
                answer: 0,
                explanation: "Page 9"
            },
            {
                question: "The action of the stylohyoid muscle is to:",
                options: [
                    "Depress the hyoid bone",
                    "Elevate the hyoid bone upwards and backwards",
                    "Depress the mandible",
                    "Elevate the larynx"
                ],
                answer: 1,
                explanation: "Page 9"
            },
            {
                question: "Which muscle forms the lateral boundaries of the submental triangle?",
                options: [
                    "Anterior belly of digastric",
                    "Posterior belly of digastric",
                    "Mylohyoid",
                    "Stylohyoid"
                ],
                answer: 0,
                explanation: "Page 15, 17"
            },
            {
                question: "The submental triangle contains all of the following EXCEPT:",
                options: [
                    "Lymph nodes",
                    "Submental vessels",
                    "Anterior jugular vein",
                    "Submandibular salivary gland"
                ],
                answer: 3,
                explanation: "Page 19"
            },
            {
                question: "The digastric triangle is bounded by:",
                options: [
                    "Anterior belly of digastric, posterior belly of digastric, and hyoid bone",
                    "Anterior belly of digastric, posterior belly of digastric, and lower border of mandible",
                    "Mylohyoid, hyoid bone, and mandible",
                    "Stylohyoid, digastric, and sternomastoid"
                ],
                answer: 1,
                explanation: "Page 22"
            },
            {
                question: "Which major salivary gland is located within the digastric triangle?",
                options: [
                    "Parotid gland",
                    "Sublingual gland",
                    "Submandibular salivary gland",
                    "Thyroid gland"
                ],
                answer: 2,
                explanation: "Page 23"
            },
            {
                question: "The digastric triangle contains lymph nodes known as:",
                options: [
                    "Submandibular lymph nodes",
                    "Submental lymph nodes",
                    "Deep cervical lymph nodes",
                    "Paratracheal lymph nodes"
                ],
                answer: 0,
                explanation: "Page 23, 24"
            },
            {
                question: "Which cranial nerve is a content of the digastric triangle?",
                options: [
                    "Vagus nerve (CN X)",
                    "Accessory nerve (CN XI)",
                    "Hypoglossal nerve (CN XII)",
                    "Glossopharyngeal nerve (CN IX)"
                ],
                answer: 2,
                explanation: "Page 25"
            },
            {
                question: "All of the following nerves are found in the digastric triangle EXCEPT:",
                options: [
                    "Lingual nerve",
                    "Nerve to mylohyoid",
                    "Hypoglossal nerve",
                    "Recurrent laryngeal nerve"
                ],
                answer: 3,
                explanation: "Page 25, 26"
            },
            {
                question: "The common facial vein is a content of which triangle?",
                options: [
                    "Submental triangle",
                    "Muscular triangle",
                    "Digastric triangle",
                    "Carotid triangle"
                ],
                answer: 2,
                explanation: "Page 28"
            },
            {
                question: "The muscular triangle is bounded by the midline, the anterior border of sternomastoid, and which other muscle?",
                options: [
                    "Posterior belly of digastric",
                    "Superior belly of omohyoid",
                    "Anterior belly of digastric",
                    "Stylohyoid"
                ],
                answer: 1,
                explanation: "Page 30"
            },
            {
                question: "The infrahyoid muscles are a key content of which triangle?",
                options: [
                    "Carotid triangle",
                    "Submental triangle",
                    "Digastric triangle",
                    "Muscular triangle"
                ],
                answer: 3,
                explanation: "Page 31"
            },
            {
                question: "Which of the following is NOT an infrahyoid muscle found in the muscular triangle?",
                options: [
                    "Sternohyoid",
                    "Stylohyoid",
                    "Sternothyroid",
                    "Thyrohyoid"
                ],
                answer: 1,
                explanation: "Page 32"
            },
            {
                question: "The sternohyoid muscle originates from the:",
                options: [
                    "Hyoid bone",
                    "Thyroid cartilage",
                    "Posterior surface of manubrium sterni and medial end of clavicle",
                    "Styloid process"
                ],
                answer: 2,
                explanation: "Page 33"
            },
            {
                question: "The sternohyoid muscle is supplied by which nerve?",
                options: [
                    "Hypoglossal nerve",
                    "Nerve to mylohyoid",
                    "Ansa cervicalis",
                    "Facial nerve"
                ],
                answer: 2,
                explanation: "Page 33"
            },
            {
                question: "The action of the sternohyoid muscle is to:",
                options: [
                    "Elevate the larynx",
                    "Depress the hyoid bone and fix it",
                    "Elevate the hyoid bone",
                    "Pull the larynx upward"
                ],
                answer: 1,
                explanation: "Page 33"
            },
            {
                question: "The sternothyroid muscle inserts onto which structure?",
                options: [
                    "Body of hyoid bone",
                    "Greater horn of hyoid bone",
                    "Oblique line of thyroid cartilage",
                    "Cricoid cartilage"
                ],
                answer: 2,
                explanation: "Page 35"
            },
            {
                question: "The thyrohyoid muscle originates from the:",
                options: [
                    "Body of hyoid bone",
                    "Manubrium sterni",
                    "First costal cartilage",
                    "Oblique line of thyroid cartilage"
                ],
                answer: 3,
                explanation: "Page 36"
            },
            {
                question: "The nerve supply to the thyrohyoid muscle is:",
                options: [
                    "Ansa cervicalis",
                    "Nerve to mylohyoid",
                    "Nerve to thyrohyoid",
                    "Accessory nerve"
                ],
                answer: 2,
                explanation: "Page 36"
            },
            {
                question: "The action of the thyrohyoid muscle is to:",
                options: [
                    "Depress the larynx",
                    "Elevate the hyoid bone",
                    "Pull the larynx upward",
                    "Depress the mandible"
                ],
                answer: 2,
                explanation: "Page 36"
            },
            {
                question: "The ansa cervicalis is a nerve loop derived from which spinal nerves?",
                options: [
                    "C1, C2, C3",
                    "C3, C4, C5",
                    "C5, C6, C7",
                    "C8, T1"
                ],
                answer: 0,
                explanation: "Page 37"
            },
            {
                question: "The ansa cervicalis is formed by the union of which two nerves?",
                options: [
                    "Descendens hypoglossi and the facial nerve",
                    "Descendens hypoglossi and descendens cervicalis",
                    "Vagus nerve and spinal accessory nerve",
                    "Hypoglossal nerve and glossopharyngeal nerve"
                ],
                answer: 1,
                explanation: "Page 37"
            },
            {
                question: "Fibers from which spinal nerve join the hypoglossal nerve to form the descendens hypoglossi?",
                options: [
                    "C2",
                    "C3",
                    "C1",
                    "C4"
                ],
                answer: 2,
                explanation: "Page 37"
            },
            {
                question: "The descendens cervicalis (inferior limb of ansa cervicalis) is derived directly from the cervical plexus, with fibers from:",
                options: [
                    "C1 & C2",
                    "C2 & C3",
                    "C3 & C4",
                    "C4 & C5"
                ],
                answer: 1,
                explanation: "Page 37"
            },
            {
                question: "All of the following muscles are supplied by branches of the ansa cervicalis EXCEPT:",
                options: [
                    "Sternohyoid",
                    "Sternothyroid",
                    "Omohyoid",
                    "Thyrohyoid"
                ],
                answer: 3,
                explanation: "Page 36, 37"
            },
            {
                question: "The carotid triangle is bounded by which three structures?",
                options: [
                    "Posterior belly of digastric, superior belly of omohyoid, and anterior border of sternomastoid",
                    "Anterior belly of digastric, hyoid bone, and sternomastoid",
                    "Stylohyoid, digastric, and trapezius",
                    "Omohyoid, sternohyoid, and midline"
                ],
                answer: 0,
                explanation: "Page 41"
            },
            {
                question: "The carotid sheath is best described as:",
                options: [
                    "A muscular layer covering the neck vessels",
                    "A column of fascia surrounding the blood vessels and nerves of the neck",
                    "The lining of the carotid artery itself",
                    "A ligament attaching the hyoid bone"
                ],
                answer: 1,
                explanation: "Page 42"
            },
            {
                question: "Which cranial nerves are found within the carotid triangle and sheath?",
                options: [
                    "CN X, XI, XII",
                    "CN IX, X, XI",
                    "CN VII, IX, X",
                    "CN XI, XII, I"
                ],
                answer: 0,
                explanation: "Page 43"
            },
            {
                question: "The three small nerves found in the carotid triangle are:",
                options: [
                    "Descendens hypoglossi, descendens cervicalis, and nerve to thyrohyoid",
                    "Vagus, accessory, and hypoglossal",
                    "Lingual, mylohyoid, and glossopharyngeal",
                    "Recurrent laryngeal, sympathetic, and phrenic"
                ],
                answer: 0,
                explanation: "Page 43"
            },
            {
                question: "Damage to the nerve supplying the anterior belly of the digastric would most likely affect which function?",
                options: [
                    "Swallowing",
                    "Depression of the mandible",
                    "Elevation of the larynx",
                    "Rotation of the head"
                ],
                answer: 1,
                explanation: "Page 7, 8"
            },
            {
                question: "A patient presents with an inability to elevate their hyoid bone upwards and backwards. Which muscle is most likely affected?",
                options: [
                    "Digastric",
                    "Stylohyoid",
                    "Sternohyoid",
                    "Thyrohyoid"
                ],
                answer: 1,
                explanation: "Page 9"
            },
            {
                question: "During a surgical procedure in the digastric triangle, a surgeon must be careful to avoid damaging the nerve that supplies the muscles of the tongue. Which nerve is this?",
                options: [
                    "Lingual nerve",
                    "Vagus nerve (CN X)",
                    "Hypoglossal nerve (CN XII)",
                    "Nerve to mylohyoid"
                ],
                answer: 2,
                explanation: "Page 25"
            }
        ];

        // Function to shuffle an array (Fisher-Yates algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to create a randomized version of the quiz data
        function createRandomizedQuizData() {
            const randomizedData = [];
            
            originalQuizData.forEach(question => {
                // Create a copy of the original question
                const randomizedQuestion = {
                    question: question.question,
                    options: [...question.options], // Copy options array
                    originalAnswer: question.answer, // Store original answer index
                    explanation: question.explanation
                };
                
                // Create an array of indices [0, 1, 2, 3]
                const indices = [0, 1, 2, 3];
                
                // Shuffle the indices
                shuffleArray(indices);
                
                // Create a new options array with shuffled order
                const shuffledOptions = indices.map(index => question.options[index]);
                
                // Find the new position of the correct answer
                const newAnswerIndex = indices.indexOf(question.answer);
                
                // Update the question with shuffled options and new answer
                randomizedQuestion.options = shuffledOptions;
                randomizedQuestion.answer = newAnswerIndex;
                
                randomizedData.push(randomizedQuestion);
            });
            
            return randomizedData;
        }

        // Create randomized quiz data
        let quizData = createRandomizedQuizData();

        // Quiz state variables
        let currentQuestion = 0;
        let score = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let incorrectQuestions = [];

        // DOM elements
        const quizContainer = document.getElementById('quiz-container');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const currentQuestionEl = document.getElementById('current-question');
        const totalQuestionsEl = document.getElementById('total-questions');
        const scoreEl = document.getElementById('score');
        const totalScoreEl = document.getElementById('total-score');
        const resultsContainer = document.getElementById('results');
        const finalScoreEl = document.getElementById('final-score');
        const performanceMessageEl = document.getElementById('performance-message');
        const restartBtn = document.getElementById('restart-btn');
        const reviewBtn = document.getElementById('review-btn');
        const reviewSection = document.getElementById('review-section');
        const incorrectQuestionsList = document.getElementById('incorrect-questions-list');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const lightText = document.querySelector('.light-text');
        const darkText = document.querySelector('.dark-text');

        // Initialize quiz
        function initQuiz() {
            totalQuestionsEl.textContent = quizData.length;
            totalScoreEl.textContent = quizData.length;
            showQuestion();
            updateProgressBar();
            
            // Initialize dark mode based on system preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
                updateToggleText(true);
            } else {
                updateToggleText(false);
            }
            
            // Event listeners
            prevBtn.addEventListener('click', showPreviousQuestion);
            nextBtn.addEventListener('click', showNextQuestion);
            restartBtn.addEventListener('click', restartQuiz);
            reviewBtn.addEventListener('click', showIncorrectQuestions);
            darkModeToggle.addEventListener('change', toggleDarkMode);
        }

        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            updateToggleText(isDarkMode);
        }

        // Update toggle text opacity
        function updateToggleText(isDarkMode) {
            if (isDarkMode) {
                lightText.style.opacity = '0.5';
                darkText.style.opacity = '1';
            } else {
                lightText.style.opacity = '1';
                darkText.style.opacity = '0.5';
            }
        }

        // Show current question
        function showQuestion() {
            currentQuestionEl.textContent = currentQuestion + 1;
            scoreEl.textContent = score;
            
            const question = quizData[currentQuestion];
            let optionsHTML = '';
            
            question.options.forEach((option, index) => {
                let optionClass = 'option';
                if (userAnswers[currentQuestion] === index) {
                    optionClass += ' selected';
                    if (index === question.answer) {
                        optionClass += ' correct';
                    } else {
                        optionClass += ' incorrect';
                    }
                }
                
                optionsHTML += `
                    <div class="${optionClass}" data-index="${index}">
                        ${String.fromCharCode(65 + index)}) ${option}
                    </div>
                `;
            });
            
            let feedbackHTML = '';
            if (userAnswers[currentQuestion] !== null) {
                const isCorrect = userAnswers[currentQuestion] === question.answer;
                const correctLetter = String.fromCharCode(65 + question.answer);
                const correctAnswerText = question.options[question.answer];
                
                feedbackHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '✓ Correct!' : '✗ Incorrect!'} 
                        ${!isCorrect ? `Correct answer: ${correctLetter}) ${correctAnswerText}` : ''}
                        <br><br>Explanation: ${question.explanation}
                    </div>
                `;
            }
            
            quizContainer.innerHTML = `
                <div class="question">
                    <div class="question-number">Question ${currentQuestion + 1}/${quizData.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="options">${optionsHTML}</div>
                    ${feedbackHTML}
                </div>
            `;
            
            // Add event listeners to options
            const optionElements = quizContainer.querySelectorAll('.option');
            optionElements.forEach(option => {
                option.addEventListener('click', selectOption);
            });
            
            // Update navigation buttons
            prevBtn.disabled = currentQuestion === 0;
            nextBtn.textContent = currentQuestion === quizData.length - 1 ? 'Finish Quiz' : 'Next';
        }

        // Select an option
        function selectOption(e) {
            if (userAnswers[currentQuestion] !== null) return; // Already answered
            
            const selectedOption = e.currentTarget;
            const selectedIndex = parseInt(selectedOption.dataset.index);
            
            userAnswers[currentQuestion] = selectedIndex;
            
            // Check if answer is correct
            if (selectedIndex === quizData[currentQuestion].answer) {
                score++;
                scoreEl.textContent = score;
            } else {
                // Add to incorrect questions list
                incorrectQuestions.push({
                    question: quizData[currentQuestion].question,
                    userAnswer: selectedIndex,
                    correctAnswer: quizData[currentQuestion].answer,
                    options: quizData[currentQuestion].options,
                    explanation: quizData[currentQuestion].explanation,
                    questionNumber: currentQuestion + 1
                });
            }
            
            showQuestion();
            updateProgressBar();
        }

        // Show next question
        function showNextQuestion() {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                showQuestion();
            } else {
                showResults();
            }
        }

        // Show previous question
        function showPreviousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion();
            }
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / quizData.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        // Show results
        function showResults() {
            quizContainer.style.display = 'none';
            document.querySelector('.navigation').style.display = 'none';
            document.querySelector('.progress-container').style.display = 'none';
            document.querySelector('.stats').style.display = 'none';
            
            finalScoreEl.textContent = score;
            
            // Performance message
            const percentage = (score / quizData.length) * 100;
            let message = '';
            if (percentage >= 80) {
                message = 'Excellent! You have a strong understanding of Neck Muscles Part 1.';
            } else if (percentage >= 60) {
                message = 'Good job! You have a solid grasp of the material.';
            } else if (percentage >= 40) {
                message = 'Not bad! Review the material and try again.';
            } else {
                message = 'Keep studying! Review the lectures and try again.';
            }
            
            performanceMessageEl.textContent = message;
            resultsContainer.style.display = 'block';
            
            // Show review button only if there are incorrect answers
            if (incorrectQuestions.length > 0) {
                reviewBtn.style.display = 'inline-block';
            } else {
                reviewBtn.style.display = 'none';
            }
        }

        // Show incorrect questions
        function showIncorrectQuestions() {
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'block';
            
            let incorrectHTML = '';
            incorrectQuestions.forEach((item, index) => {
                const correctLetter = String.fromCharCode(65 + item.correctAnswer);
                const userLetter = String.fromCharCode(65 + item.userAnswer);
                
                incorrectHTML += `
                    <div class="review-question">
                        <div class="review-question-number">Question ${item.questionNumber}</div>
                        <div class="review-question-text">${item.question}</div>
                        <div>Your answer: ${userLetter}) ${item.options[item.userAnswer]}</div>
                        <div class="review-answer review-correct">Correct answer: ${correctLetter}) ${item.options[item.correctAnswer]}</div>
                        <div class="review-explanation">${item.explanation}</div>
                    </div>
                `;
            });
            
            incorrectQuestionsList.innerHTML = incorrectHTML;
        }

        // Restart quiz
        function restartQuiz() {
            currentQuestion = 0;
            score = 0;
            userAnswers = new Array(quizData.length).fill(null);
            incorrectQuestions = [];
            
            // Re-randomize the quiz data when restarting
            quizData = createRandomizedQuizData();
            
            quizContainer.style.display = 'block';
            document.querySelector('.navigation').style.display = 'flex';
            document.querySelector('.progress-container').style.display = 'block';
            document.querySelector('.stats').style.display = 'flex';
            resultsContainer.style.display = 'none';
            reviewSection.style.display = 'none';
            
            showQuestion();
            updateProgressBar();
        }

        // Initialize the quiz when the page loads
        window.onload = initQuiz;
    </script>
</body>
</html>